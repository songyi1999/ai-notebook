# AI笔记本项目开发计划

## 项目概述

基于需求设计文档，我们将构建一个**纯本地、AI增强的个人知识管理系统**，核心特性包括：
- 纯本地运行，确保数据安全和隐私
- 使用Markdown格式存储，保证数据可移植性
- 集成本地LLM实现智能问答（RAG架构）
- 容器化部署，简化安装和运行
- 自动生成链接关系图谱，可视化知识关联

## 技术架构选型

### 前端技术栈
- **框架**: React + TypeScript
- **UI库**: Ant Design
- **编辑器**: Monaco Editor (VS Code内核)
- **图表可视化**: D3.js / ECharts
- **状态管理**: Zustand
- **构建工具**: Vite

### 后端技术栈
- **主服务**: FastAPI (Python)
- **数据库**: SQLite (轻量级本地数据库)
- **向量搜索**: ChromaDB (轻量级向量数据库)
- **AI框架**: 标准 `/v1/embeddings` 接口
- **AI模型接口**: OpenAI兼容接口 (可接入本地模型服务)
- **后台任务**: asyncio (异步处理)

### 容器化部署
- **容器化**: Docker + Docker Compose
- **服务编排**: 
  - frontend-service (React应用)
  - backend-service (FastAPI + ChromaDB)

## 详细开发计划

### ~~阶段一：基础架构搭建 (2-3周) - 已完成~~

#### ~~1.1 项目结构设计 - 已完成~~
```
ai-notebook/
├── frontend/                 # 前端React应用
├── backend/                  # 后端FastAPI应用
├── scripts/                  # 构建和部署脚本
├── docker-compose.yml        # 服务编排
├── README.md                 # 项目说明
├── DATABASE.md               # 数据库结构文档
└── requirements.txt          # 依赖管理
```

#### ~~1.2 开发环境配置 - 已完成~~
- ~~[x] 创建项目目录结构~~
- ~~[x] 配置前端开发环境 (Node.js, npm/yarn)~~
- ~~[x] 配置后端开发环境 (Python, FastAPI)~~
- ~~[x] 设置代码规范 (ESLint, Prettier, Black)~~
- ~~[x] 配置Git仓库和.gitignore~~

#### ~~1.3 容器化基础设施 - 已完成~~
- ~~[x] 编写Dockerfile (frontend, backend)~~
- ~~[x] 配置docker-compose.yml~~
- ~~[x] 设置开发和生产环境配置~~
- ~~[x] 创建启动脚本~~

#### ~~1.4 基础API设计 - 已完成~~
- ~~[x] 设计RESTful API接口~~
- ~~[x] 实现基础的CRUD操作~~
- ~~[x] 配置CORS和安全设置~~
- ~~[x] 添加API文档 (Swagger)~~

### ~~阶段二：核心功能开发 (3-4周) - 已完成~~

#### ~~2.1 Markdown编辑器实现 - 已完成~~
- ~~[x] 集成Monaco Editor~~
- ~~[x] 实现实时预览功能~~
- ~~[x] 添加语法高亮和自动补全~~
- ~~[x] 支持Markdown扩展语法~~
- ~~[x] 实现文件保存和加载~~

#### ~~2.2 文件管理系统 - 已完成~~
- ~~[x] 设计文件树结构~~
- ~~[x] 实现文件夹创建、删除、重命名~~
- ~~[x] 实现文件的增删改查~~
- ~~[x] 添加文件搜索功能~~
- ~~[x] 实现文件导入导出~~

#### ~~2.3 双向链接功能 - 已完成~~
- ~~[x] 实现 `[[笔记标题]]` 语法解析~~
- ~~[x] 自动创建链接索引~~
- ~~[x] 显示反向链接~~
- ~~[x] 实现链接图谱可视化~~
- ~~[x] 添加链接验证和修复~~

#### ~~2.4 基础搜索功能 - 已完成~~
- ~~[x] 实现基于SQLite LIKE的关键词搜索~~
- ~~[x] 添加搜索结果高亮功能~~
- ~~[x] 实现搜索历史记录~~

### ~~阶段三：AI功能集成 (4-5周) - 已完成~~

#### ~~3.1 本地LLM集成 - 已完成~~
- ~~[x] 通过OpenAI兼容接口集成LLM~~
- ~~[x] 实现模型配置的热加载~~
- ~~[x] 实现模型切换功能~~
- ~~[x] 添加模型性能监控~~
- ~~[x] 优化推理性能~~

#### ~~3.2 嵌入模型集成 - 已完成~~
- ~~[x] 通过标准 `/v1/embeddings` 接口集成嵌入模型~~
- ~~[x] 实现文本分块功能~~
- ~~[x] 调用OpenAI兼容接口生成文档嵌入向量~~
- ~~[x] 建立向量索引~~
- ~~[x] 实现增量更新机制~~

#### ~~3.3 RAG问答系统 - 已完成~~
- ~~[x] 实现语义搜索功能~~
- ~~[x] 构建基于检索增强生成的RAG问答流水线~~
- ~~[x] 添加上下文管理~~
- ~~[x] 实现对话历史记录~~
- ~~[x] 优化答案质量和相关性~~

#### ~~3.4 向量搜索优化 - 已完成~~
- ~~[x] 集成ChromaDB向量数据库~~
- ~~[x] 实现混合搜索 (关键词+语义)~~
- ~~[x] 添加搜索结果排序~~
- ~~[x] 实现搜索结果聚合~~
- ~~[x] 优化搜索性能~~

### ~~阶段四：高级功能开发 (3-4周) - 基本完成~~

#### ~~4.1 链接关系可视化 - 已完成~~
- ~~[x] 实现链接网络图谱~~
- ~~[x] 添加链接关系统计~~
- ~~[x] 构建链接图谱可视化~~
- ~~[x] 实现交互式链接浏览~~
- ~~[x] 添加链接路径分析~~

#### ~~4.2 智能推荐与混合搜索 - 已完成~~
- ~~[x] 实现相似笔记推荐（基于ChromaDB）~~
- ~~[x] 实现混合搜索（结合关键词和ChromaDB结果）~~
- ~~[x] 添加基于标签的推荐~~
- ~~[x] 支持时间维度的内容发现~~
- ~~[x] 实现智能标签生成~~
- ~~[x] 添加内容聚类展示~~

#### ~~4.3 数据导入导出 - 已完成~~
- ~~[x] 支持多种格式导入 (Markdown, HTML, PDF)~~
- ~~[x] 实现批量导入功能~~
- ~~[x] 添加数据导出选项~~
- ~~[x] 支持备份和恢复~~
- ~~[x] 实现数据同步功能~~

### ~~阶段五：优化与部署 (2-3周) - 已完成~~

#### ~~5.1 性能优化 - 已完成~~
- ~~[x] 优化前端加载速度~~
- ~~[x] 改进后端响应时间~~
- ~~[x] 优化内存使用~~
- ~~[x] 改进搜索性能~~
- ~~[x] 添加内存缓存机制 (Python字典缓存)~~

#### ~~5.2 用户体验优化 - 已完成~~
- ~~[x] 改进界面设计~~
- ~~[x] 添加快捷键支持~~
- ~~[x] 实现主题切换~~
- ~~[x] 优化移动端适配~~
- ~~[x] 添加用户引导~~

#### 5.3 测试完善 - 进行中
- [x] 编写单元测试
- [x] 添加集成测试
- [ ] 实现端到端测试
- [ ] 性能测试
- [ ] 安全测试

#### ~~5.4 文档编写 - 已完成~~
- ~~[x] 完善README.md~~
- ~~[x] 编写用户手册~~
- ~~[x] 创建开发者文档~~
- ~~[x] 添加API文档~~
- ~~[x] 编写部署指南~~

### 阶段六：MCP集成支持 (2-3周) - 新增

#### 6.1 MCP基础架构 (1周)
- [ ] 研究MCP协议规范和最佳实践
- [ ] 设计MCP服务器架构
- [ ] 实现MCP协议基础通信层
- [ ] 添加MCP配置管理
- [ ] 创建MCP服务器启动脚本

#### 6.2 数据源适配器 (1周)
- [ ] 实现笔记文件MCP适配器
- [ ] 实现搜索功能MCP适配器
- [ ] 实现链接关系MCP适配器
- [ ] 实现标签系统MCP适配器
- [ ] 添加数据源权限控制

#### 6.3 工具集成接口 (0.5周)
- [ ] 实现文件操作工具接口
- [ ] 实现搜索查询工具接口
- [ ] 实现AI问答工具接口
- [ ] 实现链接分析工具接口
- [ ] 添加工具调用日志记录

#### 6.4 MCP客户端集成 (0.5周)
- [ ] 前端MCP客户端集成
- [ ] MCP服务发现机制
- [ ] 实现MCP工具调用界面
- [ ] 添加MCP状态监控
- [ ] 创建MCP使用文档

## 里程碑和时间节点

| 阶段 | 里程碑 | 状态 | 交付物 |
|------|--------|------|--------|
| ~~阶段一~~ | ~~基础架构完成~~ | ✅ 已完成 | ~~可运行的基础框架~~ |
| ~~阶段二~~ | ~~核心功能完成~~ | ✅ 已完成 | ~~基础笔记管理功能~~ |
| ~~阶段三~~ | ~~AI功能集成~~ | ✅ 已完成 | ~~智能问答系统~~ |
| ~~阶段四~~ | ~~高级功能完成~~ | ✅ 已完成 | ~~链接可视化和智能推荐~~ |
| ~~阶段五~~ | ~~项目优化完成~~ | ✅ 基本完成 | ~~完整可部署的产品~~ |
| 阶段六 | MCP集成完成 | 🔄 计划中 | MCP兼容的AI笔记本系统 |

## 风险评估和应对策略

### 技术风险
1. **MCP协议兼容性**
   - 风险：MCP协议规范变更，影响集成效果
   - 应对：关注MCP官方更新，实现灵活的适配层

2. **性能影响**
   - 风险：MCP集成可能影响系统性能
   - 应对：实现异步MCP调用，添加性能监控

3. **安全性考虑**
   - 风险：MCP接口可能带来安全隐患
   - 应对：实现严格的权限控制和数据验证

### 开发风险
1. **MCP生态成熟度**
   - 风险：MCP生态系统还在发展中
   - 应对：保持功能独立性，MCP作为可选扩展

## MCP集成技术方案

### MCP服务器实现
```python
# 基于官方MCP Python SDK
from mcp import Server, Resource, Tool
from mcp.types import TextContent, ImageContent

class NotebookMCPServer(Server):
    """AI笔记本MCP服务器"""
    
    async def list_resources(self) -> list[Resource]:
        """列出可用的笔记资源"""
        pass
    
    async def list_tools(self) -> list[Tool]:
        """列出可用的工具"""
        pass
```

### 支持的MCP功能
1. **资源访问**：
   - 笔记文件读取
   - 搜索结果获取
   - 链接关系查询
   - 标签信息访问

2. **工具调用**：
   - 文件创建/编辑/删除
   - 智能搜索执行
   - AI问答调用
   - 链接分析工具

3. **数据格式**：
   - 支持文本、Markdown、JSON格式
   - 支持结构化数据返回
   - 支持流式数据传输

### 配置示例
```yaml
# docker-compose.yml 新增MCP服务
services:
  mcp-server:
    build: ./backend
    command: python -m app.mcp_server
    ports:
      - "3001:3001"
    environment:
      - MCP_PORT=3001
      - MCP_HOST=0.0.0.0
    volumes:
      - ./data:/app/data
      - ./notes:/app/notes
```

## 资源需求

### 开发环境
- 开发机器：至少16GB内存，支持GPU加速（可选）
- 存储空间：至少100GB用于模型和数据存储
- 网络：稳定的网络连接用于下载模型和依赖

### 人力资源
- 全栈开发工程师：1-2人
- AI/ML工程师：1人（兼职或顾问）

## 质量保证

### 代码质量
- 代码审查机制
- 自动化测试覆盖率 > 80%
- 代码规范检查
- 性能监控和日志记录

### 用户体验
- 用户测试和反馈收集
- 界面一致性检查
- 响应时间监控
- 错误处理和用户提示

## 后续发展规划

### 短期规划 (3-6个月)
- MCP生态系统集成
- 第三方MCP服务器支持
- 性能优化和bug修复
- 多语言支持

### 长期规划 (6-12个月)
- 移动端应用开发
- 团队协作功能
- 云端同步选项
- 企业版功能开发

---

## 总结

AI笔记本项目已基本完成所有核心功能，包括：
- ✅ 完整的笔记管理系统
- ✅ 智能AI问答功能
- ✅ 高性能搜索系统
- ✅ 链接关系可视化
- ✅ 容器化部署方案

下一阶段将重点关注：
1. **MCP集成**：实现标准化的AI工具协议支持
2. **测试完善**：提高测试覆盖率和系统稳定性
3. **生态扩展**：支持更多第三方工具和服务

这将使AI笔记本成为一个真正开放、可扩展的AI增强知识管理平台。 